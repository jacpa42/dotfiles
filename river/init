################################# VARS ###################################

colour_picker="$HOME/Projects/dotfiles/hypr/color_picker.sh"
screenshot="$HOME/Projects/dotfiles/hypr/screenshot.sh"

# menu stuff (wmenu_opts set in ~/.zprofile)
launcher="$HOME/Projects/dotfiles/hypr/wmenu/run.sh"
select_audio_sink="$HOME/Projects/dotfiles/hypr/wmenu/sinks.sh"
emoji="$HOME/Projects/dotfiles/hypr/wmenu/emojis.sh"
password="$HOME/Projects/dotfiles/hypr/wmenu/passwords.sh"

# wallpaper stuff
default_wallpaper="knight-templar"
cyclewall="$HOME/Projects/dotfiles/hypr/cyclewall.sh"
wallpaper_directory="$HOME/Projects/muur_papier/"

# volume controls
increase_volume="/usr/bin/wpctl set-volume @DEFAULT_AUDIO_SINK@ 1%+"
decrease_volume="/usr/bin/wpctl set-volume @DEFAULT_AUDIO_SINK@ 1%-"
mute_volume="/usr/bin/wpctl set-volume @DEFAULT_AUDIO_SINK@ 0%"
max_volume="/usr/bin/wpctl set-volume @DEFAULT_AUDIO_SINK@ 100%"

# music player stuff
player="spotify"
player_playpause="/usr/bin/playerctl --player=$player play-pause"
player_next="/usr/bin/playerctl --player=$player next"
player_previous="/usr/bin/playerctl --player=$player previous"

mod="Super"

################################# OPTS ###################################

riverctl default-attach-mode top
riverctl border-color-focused 0xe82424ff
riverctl border-color-unfocused 0x24253799
riverctl border-width 2

# Mouse
riverctl set-repeat 60 200
riverctl focus-follows-cursor always
riverctl hide-cursor when-typing enabled
riverctl xcursor-theme "$CURSOR_THEME"

riverctl default-layout rivercarro

# razer keyboard stuff. doesnt work atm :(
# riverctl keyboard-layout -model "razer" -variant "razer-blade-keyboard" -options "caps:escape" gb

################################# BINDINGS ###############################

riverctl map normal $mod W close

riverctl map normal $mod Space spawn "$HOME/Projects/dotfiles/hypr/wmenu/run.sh"
riverctl map normal $mod Delete exit

riverctl map normal $mod T toggle-float
riverctl map normal $mod Return toggle-fullscreen
riverctl map normal $mod O spawn "$emoji"
riverctl map normal $mod P spawn "$password"
riverctl map normal $mod A spawn "$select_audio_sink"
riverctl map normal $mod I spawn "fd -ejpg . $wallpaper_directory | imv"
riverctl map normal $mod U spawn "$cyclewall -w $wallpaper_directory"
riverctl map normal $mod+Shift U spawn "$cyclewall -w $wallpaper_directory -r"
riverctl map normal $mod+Alt U spawn "$cyclewall -w $wallpaper_directory -d $default_wallpaper"
riverctl map normal $mod+Control U spawn "$cyclewall -w $wallpaper_directory -R"

riverctl map normal $mod E focus-view next
riverctl map normal $mod R focus-view previous
riverctl map normal $mod+Alt E send-layout-cmd rivercarro "main-ratio -0.05"
riverctl map normal $mod+Alt R send-layout-cmd rivercarro "main-ratio +0.05"

w0=$((1 << 0))
w1=$((1 << 1))
w2=$((1 << 2))
w3=$((1 << 3))
w4=$((1 << 4))
w5=$((1 << 5))
w6=$((1 << 6))

riverctl map normal $mod S set-focused-tags $w0
riverctl map normal $mod D set-focused-tags $w1
riverctl map normal $mod F set-focused-tags $w2
riverctl map normal $mod J set-focused-tags $w3
riverctl map normal $mod K set-focused-tags $w4
riverctl map normal $mod L set-focused-tags $w5
riverctl map normal $mod M set-focused-tags $w6

riverctl map normal $mod+Alt S set-focused-tags $w0
riverctl map normal $mod+Alt D set-focused-tags $w1
riverctl map normal $mod+Alt F set-focused-tags $w2
riverctl map normal $mod+Alt J set-focused-tags $w3
riverctl map normal $mod+Alt K set-focused-tags $w4
riverctl map normal $mod+Alt L set-focused-tags $w5
riverctl map normal $mod+Alt M set-focused-tags $w6

riverctl map normal $mod+Alt 0 spawn "$screenshot"
riverctl map normal $mod+Alt 1 spawn "$player_playpause"
riverctl map normal $mod+Alt 2 spawn "$player_next"
riverctl map normal $mod+Alt 3 spawn "$player_previous"
riverctl map -repeat normal $mod+Alt 4 spawn "$decrease_volume"
riverctl map -repeat normal $mod+Alt 5 spawn "$increase_volume"
riverctl map normal $mod+Alt 6 spawn "$mute_volume"
riverctl map normal $mod+Alt 7 spawn "$max_volume"
riverctl map normal $mod C spawn "$colour_picker"

riverctl map-pointer normal $mod BTN_LEFT move-view
riverctl map-pointer normal $mod BTN_RIGHT resize-view

################################# RULES #################################

# to get app ids us lswt (https://sr.ht/~leon_plickat/lswt)
riverctl rule-add -app-id * no-float
riverctl rule-add -app-id mpv tags $w6
riverctl rule-add -app-id mpv fullscreen
riverctl rule-add -app-id Spotify tags $w0
riverctl rule-add -app-id *qelectrotech* tags $w5
riverctl rule-add -app-id "Pinentry-gtk" float
riverctl rule-add -app-id Aseprite tags $w5
riverctl rule-add -app-id discord tags $w0
riverctl rule-add -app-id steam tags $w4
riverctl rule-add -app-id steam_app* tags $w4
riverctl rule-add -app-id steam float
riverctl rule-add -app-id *Steam* no-float
riverctl rule-add -title *DOOM* fullscreen
riverctl rule-add -title "Hollow Knight Silksong" fullscreen
riverctl rule-add -title "Hollow Knight Silksong" tags $w4
riverctl rule-add -app-id *qutebrowser* tags $w2
riverctl rule-add -app-id com.mitchellh.ghostty tags $w3
riverctl rule-add -app-id resolve tags $w5
riverctl rule-add -app-id resolve float
riverctl rule-add -title "DaVinci Resolve Studio" no-float

################################# EXEC ##################################

rivercarro -inner-gaps 0 -outer-gaps 0 -main-location monocle &
ghostty -e tmux new-session -A -s jacob &
$cyclewall -w $wallpaper_directory -d "$default_wallpaper" &
dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP &
copyq --start-server &
polkit-kde-authentication-agent-1 &
gsettings set org.gnome.desktop.interface cursor-theme \'$CURSOR_THEME\' &
